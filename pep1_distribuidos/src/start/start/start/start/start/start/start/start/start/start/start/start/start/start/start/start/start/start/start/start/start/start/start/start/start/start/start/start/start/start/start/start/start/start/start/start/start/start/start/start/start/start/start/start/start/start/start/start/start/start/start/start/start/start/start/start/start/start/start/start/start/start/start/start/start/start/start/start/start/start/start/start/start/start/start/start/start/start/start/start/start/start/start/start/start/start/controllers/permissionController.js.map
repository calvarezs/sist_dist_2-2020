{"version":3,"sources":["../../controllers/permissionController.js"],"names":["express","require","router","Router","Permission","Person","check","validationResult","validate","clean","format","PersonController","post","req","res","console","log","body","send","add","myData","firstname","email","rut","adress","person","create","err","custom","withMessage","not","isEmpty","isEmail","normalizeEmail","motivo","findOne","where","permission","render","title","status","get","findAll","json","data","message","id","params","_id","module","exports"],"mappings":"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","sourcesContent":["const express = require('express');\nconst router = express.Router();\nconst Permission = require('../models/Permission');\nconst Person = require('../models/Person');\nconst { check, validationResult } = require('express-validator');\nconst { validate, clean, format } = require('rut.js')\nconst {PersonController} = require('./personController.js');\n\nrouter.post('/permission', (req, res) => {\n    console.log(req.body);\n    res.send('received')\n});\n\n\nasync function add (myData) {\n    const {\n        firstname,\n        email,\n        rut,\n        adress\n    } = myData;\n    try{\n        let person = await Person.create({firstname, email, rut, adress})\n        if (person) {\n            console.log(\"SE HA CREADO UN USUARIOOO!!!!!!!!!!!!!!\")\n            return;\n        }\n    }\n    catch(err){\n        console.log(err);\n        console.log(\"ERROR AL CREAR USUARIOOO!!!!!!!!!!!!!!\")\n        return;\n    }\n  }\n\nrouter.post('/add', [\n        check('rut')\n            .custom(rut => validate(rut))\n            .withMessage('Rut inv치lido o incorrecto'),\n        check('firstname')\n            .not().isEmpty()\n            .withMessage('Por favor ingrese su nombre completo'),\n        check('adress')\n            .not().isEmpty()\n            .withMessage('Por favor ingrese una direcci칩n de domicilio v치lida'),\n        check('motivo')\n            .not().isEmpty()\n            .withMessage('Por favor ingrese el motivo de salida'),\n        check('email')\n            .isEmail()\n            .normalizeEmail() \n            .withMessage('Por favor ingrese un correo v치lido'),\n    ],\n    async(req, res) => {\n    try{\n        const {\n            rut,\n            motivo,\n            adress\n        } = req.body;\n        var myData = {\n            firstname  : req.body.firstname,\n            email : req.body.email,\n            rut : req.body.rut,\n            adress: req.body.adress\n        };\n        console.log(\"EL RUT A BUSCAR EEEEEEEEEEEEEEEEES!!!!!!!!!!! \"+req.body.rut);\n\n\n        \n        const person = await Person.findOne({\n            where: {\n                rut\n            }\n        });\n        console.log(\"LA PERSONA ES:\")\n        console.log(person)\n        if(person==null){\n            console.log(\"Se va a agregar una persona que no esta registrada!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\")\n            add(myData);\n        }\n        const permission = await Permission.create({rut, motivo, adress})\n        if (permission) {\n            //return res.json(permission); \n            res.render('cond', { title: 'Registration form' });\n        }\n        else{\n            res.status(400).send(\"Error en agregar salvoconducto...\");\n        }\n    }\n    catch(err){\n        console.log(err);\n        res.status(400).send(\"Error in save a permission\");\n    }\n});\n\n\nrouter.get('/getall',async (req, res) => { \n    try{\n        let permission = await Permission.findAll();\n        if(permission){\n            res.json({\n                data: permission\n            });\n        }\n    }\n    catch(err){\n        console.log(err);\n        res.status(500).json({\n            message:\"It couldn't get any person\"\n    })\n    }\n  });\n\nrouter.get('/',async (req, res) => { \ntry{\n    let permission = await Permission.findAll();\n    if(permission){\n        res.json({\n            data: permission\n        });\n    }\n}\ncatch(err){\n    console.log(err);\n    res.status(500).json({\n        message:\"Algo salio mal\"\n})\n}\n});\n\n\nrouter.get('/get/:id',async (req, res) => { \n    var id = req.params.id;\n    try{\n        const permission = await Permission.findOne({_id: id});\n        return res.json(permission);\n    }\n    catch(err){\n        res.status(500).json({\n            message:\"It couldn't get the permission\"\n        })\n    }\n});\n\nmodule.exports = router;\n"],"file":"permissionController.js"}